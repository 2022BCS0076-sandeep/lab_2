name: Train Model

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  build-train:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: "3.10"

    - name: Install Dependencies
      run: |
        pip install -r requirements.txt

    - name: Run All Experiments
      run: |
        mkdir -p outputs/models
        mkdir -p outputs/results

        for f in experiments/*.json; do
          echo "Running experiment $f"
          python src/train.py "$f"
        done

    - name: Job Summary
      run: |
        echo "## ðŸ§‘ Student Info" >> $GITHUB_STEP_SUMMARY
        echo "**Name:** Sandeep Chintu" >> $GITHUB_STEP_SUMMARY
        echo "**Roll No:** 2022BCS0076" >> $GITHUB_STEP_SUMMARY
        echo "## ðŸ“Š Experiment Metrics" >> $GITHUB_STEP_SUMMARY
        for file in outputs/results/*.json; do
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`json" >> $GITHUB_STEP_SUMMARY
          cat "$file" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
        done

    - name: Upload Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: trained-models-and-results
        path: |
          outputs/models/
          outputs/results/
